---
export const prerender = false;

import {actions} from "astro:actions";

if (!Astro.cookies.has('user_token'))
    return Astro.redirect('/login');

const token = Astro.cookies.get('user_token').value;
const backendName = import.meta.env.PUBLIC_BACKEND_NAME;

try {
    await fetch(`https://${backendName}/_r2m/logout`, {
        headers: {
            Authorization: `Bearer ${token}`
        }
    });

    Astro.cookies.delete('user_token');
} catch (error) {
    return Astro.redirect('/');
}

return Astro.redirect('/');
---
